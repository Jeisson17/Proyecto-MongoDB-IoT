# 游 Proyecto MongoDB IoT: Simulaci칩n de Monitoreo Ambiental

Este repositorio contiene los scripts y la documentaci칩n para simular un sistema de monitoreo ambiental basado en IoT utilizando MongoDB. Se incluyen herramientas para la generaci칩n de datos, la importaci칩n a MongoDB, y la ejecuci칩n de operaciones CRUD y pipelines de agregaci칩n para an치lisis de datos.

## 游늶 Configuraci칩n y Primeros Pasos

Para replicar y ejecutar este proyecto, sigue los siguientes pasos en tu terminal. Los comandos se proporcionan en formato `bash` para una ejecuci칩n directa.

### 1. **Instalaci칩n de Requisitos (Verifica que est칠n instalados):**
Aseg칰rate de tener instalados los siguientes componentes en tu sistema. Si no es as칤, desc치rgalos e inst치lalos desde los enlaces proporcionados:
*   **Python 3.x:** Descarga desde [python.org](https://www.python.org/downloads/).
*   **MongoDB Community Server:** Descarga e instala desde [mongodb.com/try/download/community](https://www.mongodb.com/try/download/community/).
*   **MongoDB Shell (mongosh):** Instala `mongosh` siguiendo las instrucciones en [mongodb.com/docs/mongodb-shell/install/](https://www.mongodb.com/docs/mongodb-shell/install/).
*   **Git:** Descarga e instala desde [git-scm.com/downloads](https://git-scm.com/downloads).

### 2. **Clonar el Repositorio:**
Abre tu terminal y ejecuta el siguiente comando para clonar este repositorio:
```bash  
git clone https://github.com/tu_usuario_github/nombre_de_tu_repositorio.git  
cd nombre_de_tu_repositorio
IMPORTANTE: Reemplaza https://github.com/tu_usuario_github/nombre_de_tu_repositorio.git con la URL real de tu repositorio de GitHub.

3. Generar Datos Simulados:
Ejecuta el script de Python generador_datos.py para crear el archivo datos_sensores.json, que contiene los datos de ejemplo para la base de datos:

bash
python generador_datos.py
Este comando generar치 o sobrescribir치 datos_sensores.json en el directorio actual.

4. Iniciar MongoDB (Si no est치 ya corriendo):
Aseg칰rate de que tu servidor MongoDB est칠 en ejecuci칩n. El m칠todo de inicio puede variar seg칰n tu sistema operativo. Aqu칤 hay ejemplos comunes:

En sistemas Linux (ej. Ubuntu/Debian) con systemd:

bash
sudo systemctl start mongod
sudo systemctl enable mongod # Para que inicie autom치ticamente al arrancar el sistema
En macOS (si instalaste con Homebrew):

bash
brew services start mongodb-community
En Windows: Generalmente, MongoDB se instala como un servicio de Windows y se inicia autom치ticamente. Puedes verificar su estado en la aplicaci칩n "Servicios" (buscando "MongoDB Server").

Para verificar el estado del servicio MongoDB:

bash
sudo systemctl status mongod # Para Linux
brew services list # Para macOS
5. Importar Datos a MongoDB:
Usa la herramienta mongoimport para cargar los datos desde el archivo datos_sensores.json a la base de datos ambiental_iot en la colecci칩n lecturas_sensores:

bash
mongoimport --db ambiental_iot --collection lecturas_sensores --file datos_sensores.json --jsonArray
Este comando crear치 la base de datos y la colecci칩n si no existen, y luego importar치 todos los documentos desde el archivo JSON.

6. Ejecutar Comandos MongoDB desde mongosh:
Ahora interactuaremos con MongoDB utilizando el shell mongosh. Es CRUCIAL ejecutar estos comandos paso a paso para observar las salidas y tomar las capturas de pantalla necesarias para cualquier informe o documentaci칩n.

Primero, inicia mongosh desde tu terminal:

bash
mongosh
Una vez que veas el prompt de mongosh (generalmente > o un prefijo similar), copia y pega los comandos del archivo comandos_mongodb.js secci칩n por secci칩n o l칤nea por l칤nea. Aqu칤 se muestra el contenido del archivo comandos_mongodb.js para que puedas seguirlo:

javascript
// =============================================================================
// Archivo: comandos_mongodb.js (Ejecutar en mongosh)
// =============================================================================

// Seleccionar la base de datos de trabajo
use ambiental_iot;

print("--- Iniciando operaciones CRUD y Agregaci칩n ---");

// =============================================================================
// 1. VERIFICACI칍N INICIAL
// =============================================================================
print("\n--- 1.0. Verificaci칩n inicial de documentos ---");
db.lecturas_sensores.find({}).limit(5);

// =============================================================================
// 2. OPERACIONES CRUD (Create, Read, Update, Delete)
// =============================================================================

// --- 2.1. CREATE (Insertar un nuevo documento) ---
print("\n--- 2.1. Insertando un nuevo documento (CREATE) ---");
db.lecturas_sensores.insertOne(
    {
        "sensor_id": "SNSR-NEW-007",
        "ubicacion": {
            "ciudad": "Santa Marta",
            "pais": "Colombia",
            "latitud": 11.233,
            "longitud": -74.200
        },
        "timestamp": new Date(),
        "tipo_sensor": "Calidad del Aire",
        "metadatos": {
            "fabricante": "IoTTech",
            "modelo": "AQI-Pro",
            "firmware_version": "1.2.0",
            "estado_bateria": 95,
            "ultima_actualizacion": new Date()
        },
        "mediciones": {
            "temperatura": 28.5,
            "humedad": 80.2,
            "presion_atmosferica": 1010.5,
            "pm2_5": 35.8,
            "pm10": 60.1,
            "o3": 0.045,
            "co": 3.2,
            "no2": 0.021
        }
    }
);

// --- 2.2. READ (Consultar documentos) ---
print("\n--- 2.2. Consultando documentos (READ) ---");

// 2.2.1. Encontrar un documento por su ID de sensor espec칤fico
print("\n   --- 2.2.1. Buscando el sensor reci칠n insertado (SNSR-NEW-007) ---");
db.lecturas_sensores.findOne({"sensor_id": "SNSR-NEW-007"});

// 2.2.2. Encontrar documentos con un filtro y proyecci칩n
print("\n   --- 2.2.2. Lecturas de Bogot치 con PM2.5 y temperatura (filtrado y proyecci칩n) ---");
db.lecturas_sensores.find(
    {"ubicacion.ciudad": "Bogota"},
    {
        "sensor_id": 1,
        "ubicacion.ciudad": 1,
        "mediciones.pm2_5": 1,
        "mediciones.temperatura": 1,
        "timestamp": 1,
        "_id": 0
    }
).limit(5).pretty();

// 2.2.3. Encontrar documentos que cumplen una condici칩n de valor (PM2.5 alta)
print("\n   --- 2.2.3. Lecturas con PM2.5 superior a 50 ---");
db.lecturas_sensores.find(
    {"mediciones.pm2_5": {"$gt": 50}},
    {"sensor_id": 1, "ubicacion.ciudad": 1, "mediciones.pm2_5": 1, "timestamp": 1, "_id": 0}
).limit(10).pretty();

// --- 2.3. UPDATE (Actualizar documentos) ---
print("\n--- 2.3. Actualizando documentos (UPDATE) ---");

// 2.3.1. Actualizar un solo documento
print("\n   --- 2.3.1. Actualizando estado de bater칤a del SNSR-NEW-007 ---");
db.lecturas_sensores.updateOne(
    {"sensor_id": "SNSR-NEW-007"},
    {
        "$set": {
            "metadatos.estado_bateria": 100,
            "metadatos.ultima_actualizacion": new Date()
        }
    }
);

// 2.3.2. Actualizar m칰ltiples documentos (Aumentar PM2.5 en un 10%)
print("\n   --- 2.3.2. Aumentando PM2.5 en un 10% para sensores de Bogot치 ($mul) ---");
db.lecturas_sensores.updateMany(
    {"ubicacion.ciudad": "Bogota"},
    {"$mul": {"mediciones.pm2_5": 1.1}}
);

// 2.3.3. Verificaci칩n del cambio de PM2.5
print("\n   --- 2.3.3. Verificando cambio de PM2.5 en un sensor de Bogot치 ---");
db.lecturas_sensores.find(
    {"ubicacion.ciudad": "Bogota"},
    {"sensor_id": 1, "mediciones.pm2_5": 1, "_id": 0}
).limit(1).pretty();

// --- 2.4. DELETE (Eliminar documentos) ---
print("\n--- 2.4. Eliminando documentos (DELETE) ---");

// 2.4.1. Eliminar un solo documento
print("\n   --- 2.4.1. Eliminando el sensor SNSR-NEW-007 ---");
db.lecturas_sensores.deleteOne({"sensor_id": "SNSR-NEW-007"});

// 2.4.2. Eliminar m칰ltiples documentos
print("\n   --- 2.4.2. Eliminando todas las lecturas del sensor SNSR-MED-002 ---");
db.lecturas_sensores.deleteMany({"sensor_id": "SNSR-MED-002"});

// 2.4.3. Verificaci칩n de la eliminaci칩n
print("\n   --- 2.4.3. Verificando eliminaci칩n del SNSR-NEW-007 ---");
db.lecturas_sensores.findOne({"sensor_id": "SNSR-NEW-007"});

// =============================================================================
// 3. PIPELINE DE AGREGACI칍N
// =============================================================================
print("\n--- 3.0. Ejecutando Operaciones de Agregaci칩n ---");

// 3.1. Contar el n칰mero de lecturas por ciudad
print("\n   --- 3.1. Conteo de lecturas por ciudad ---");
db.lecturas_sensores.aggregate([
    { "$group": { "_id": "$ubicacion.ciudad", "total_lecturas": { "$sum": 1 } } },
    { "$sort": { "total_lecturas": -1 } }
]);

// 3.2. Calcular promedios, m치ximos y m칤nimos de mediciones por ciudad
print("\n   --- 3.2. Estad칤sticas de mediciones (promedios, m치ximos, m칤nimos) por ciudad ---");
db.lecturas_sensores.aggregate([
    {
        "$group": {
            "_id": "$ubicacion.ciudad",
            "promedio_temperatura": { "$avg": "$mediciones.temperatura" },
            "max_temperatura": { "$max": "$mediciones.temperatura" },
            "min_temperatura": { "$min": "$mediciones.temperatura" },
            "promedio_humedad": { "$avg": "$mediciones.humedad" },
            "max_pm2_5": { "$max": "$mediciones.pm2_5" },
            "promedio_pm2_5": { "$avg": "$mediciones.pm2_5" }
        }
    },
    { "$sort": { "max_pm2_5": -1 } }
]);

// 3.3. Obtener la 칰ltima lectura de cada sensor
print("\n   --- 3.3. 칔ltima lectura de cada sensor ---");
db.lecturas_sensores.aggregate([
    { "$sort": { "sensor_id": 1, "timestamp": -1 } },
    { "$group": { "_id": "$sensor_id", "ultima_lectura": { "$first": "$$ROOT" } } }
]);

// 3.4. Contar cu치ntas alertas de PM2.5 (> 50) hay por ciudad y tipo de sensor
print("\n   --- 3.4. Conteo de alertas PM2.5 (>50) por ciudad y tipo de sensor ---");
db.lecturas_sensores.aggregate([
    { "$match": { "mediciones.pm2_5": { "$gt": 50 } } },
    {
        "$group": {
            "_id": { "ciudad": "$ubicacion.ciudad", "tipo_sensor": "$tipo_sensor" },
            "alertas_pm2_5_altas": { "$sum": 1 }
        }
    },
    { "$sort": { "alertas_pm2_5_altas": -1 } }
]);

// =============================================================================
// 4. GESTI칍N DE 칈NDICES
// =============================================================================
print("\n--- 4.0. Gesti칩n de 칈ndices para optimizaci칩n de consultas ---");

// 4.1. Crear un 칤ndice en 'ubicacion.ciudad'
print("\n   --- 4.1. Creando 칤ndice en 'ubicacion.ciudad' ---");
db.lecturas_sensores.createIndex({"ubicacion.ciudad": 1});

// 4.2. Crear un 칤ndice compuesto en 'sensor_id' y 'timestamp' (descendente)
print("\n   --- 4.2. Creando 칤ndice compuesto en 'sensor_id' y 'timestamp' ---");
db.lecturas_sensores.createIndex({"sensor_id": 1, "timestamp": -1});

// 4.3. Listar todos los 칤ndices de la colecci칩n
print("\n   --- 4.3. Listando todos los 칤ndices de la colecci칩n ---");
db.lecturas_sensores.getIndexes();

print("\n--- Fin de las operaciones CRUD y Agregaci칩n ---");
游뚿 RECUERDA: Para tu informe, debes tomar capturas de pantalla de la salida de cada comando relevante ejecutado en mongosh. Para salir de mongosh, escribe exit y presiona Enter.
